# infrastructure/ansible/inventory/hosts.yml
# Inventory for Entrepreneur OS Cloud
# Update with actual IPs after running collect-inventory.sh

all:
  vars:
    ansible_user: root
    ansible_python_interpreter: /usr/bin/python3
    ansible_ssh_common_args: '-o StrictHostKeyChecking=no'

    # Docker users to add to docker group
    docker_users:
      - root
      - admin

    # Tailscale configuration
    use_tailscale: true
    tailscale_advertise_routes: true

    # China-specific settings
    use_china_mirrors: true
    timezone: "Asia/Shanghai"

    # Monitoring
    enable_monitoring: true
    enable_security: true

children:
  # ============================================
  # COMPUTE NODES (Running applications)
  # ============================================
  compute:
    hosts:
      dv02:
        ansible_host: 192.168.1.102  # Update with actual IP or Tailscale IP
        node_role: master
        node_labels:
          - compute
          - master
          - vendure-master
        resources:
          cpu: "Intel i9"
          ram: "32GB"
          gpu: "NVIDIA RTX 3070"
          disk: "1TB NVMe"
        services:
          - vendure-master
          - postgres-master
          - redis

      dv04:
        ansible_host: 192.168.1.104  # Update with actual IP or Tailscale IP
        node_role: worker
        node_labels:
          - compute
          - worker
          - vendure-ecommerce
        resources:
          cpu: "Intel i9"
          ram: "32GB"
          gpu: "NVIDIA RTX 3070"
          disk: "1TB NVMe"
        services:
          - vendure-ecommerce
          - postgres-ecommerce
          - storefront-nextjs
          - storefront-vite
          - n8n

  # ============================================
  # MONITORING NODES (Observability stack)
  # ============================================
  monitoring:
    hosts:
      dv05:
        ansible_host: 192.168.1.105  # Update with actual IP or Tailscale IP
        node_role: monitoring-primary
        node_labels:
          - monitoring
          - opensearch-master
          - storage
        resources:
          cpu: "AMD Ryzen 7"
          ram: "32GB"
          disk_ssd: "500GB"
          disk_hdd: "2TB"
        services:
          - opensearch-master
          - opensearch-data-1
          - grafana
          - prometheus
          - wazuh-manager
          - minio
          - bitwarden

      dv06:
        ansible_host: 192.168.1.106  # Update with actual IP or Tailscale IP
        node_role: monitoring-secondary
        node_labels:
          - monitoring
          - opensearch-data
          - storage
        resources:
          cpu: "AMD Ryzen 7"
          ram: "32GB"
          disk_ssd: "500GB"
          disk_hdd: "2TB"
        services:
          - opensearch-data-2
          - vector
          - redpanda
          - uptime-kuma
          - netdata

  # ============================================
  # GATEWAY (Public-facing VPS)
  # ============================================
  gateway:
    hosts:
      do-vps:
        ansible_host: your-vps-ip.com  # Update with DO VPS IP
        ansible_user: root
        node_role: gateway
        node_labels:
          - gateway
          - reverse-proxy
          - vpn-exit
        resources:
          cpu: "2 vCPU"
          ram: "4GB"
          disk: "80GB"
        services:
          - nginx
          - wireguard
          - certbot
          - fail2ban

  # ============================================
  # DEVELOPMENT (Not for production)
  # ============================================
  development:
    hosts:
      dv01:
        ansible_host: 192.168.1.101  # Update with actual IP
        ansible_connection: local  # If running on this machine
        node_role: development
        node_labels:
          - development
          - workstation
        resources:
          cpu: "Intel i9"
          ram: "32GB"
          gpu: "NVIDIA RTX 3070"
          disk: "1TB NVMe"
        services:
          - intellij-idea
          - cursor
          - docker-desktop

  # ============================================
  # LOGICAL GROUPS
  # ============================================

  # All Linux nodes (exclude Windows dev machine)
  linux_nodes:
    children:
      - compute
      - monitoring
      - gateway

  # Nodes in China (behind GFW)
  china_nodes:
    children:
      - compute
      - monitoring
      - development

  # Nodes that run Docker
  docker_nodes:
    children:
      - compute
      - monitoring

  # Nodes that run K3s (if we use Kubernetes)
  k3s_cluster:
    children:
      - compute
    vars:
      k3s_version: "v1.28.5+k3s1"
      k3s_token: "{{ lookup('env', 'K3S_TOKEN') }}"

  # Nodes that run OpenSearch
  opensearch_cluster:
    hosts:
      dv05:
      dv06:
    vars:
      opensearch_cluster_name: "entrepreneur-os-logs"
      opensearch_version: "2.11.1"

  # Nodes that run Vendure
  vendure_nodes:
    hosts:
      dv02:
        vendure_instance: master
        vendure_port: 3000
        vendure_admin_port: 3001
        postgres_port: 5432
        postgres_db: vendure_master

      dv04:
        vendure_instance: ecommerce
        vendure_port: 3002
        vendure_admin_port: 3003
        postgres_port: 5433
        postgres_db: vendure_ecommerce

  # ============================================
  # ROLE-BASED GROUPS
  # ============================================

  # Master nodes (for HA setups)
  masters:
    hosts:
      dv02:

  # Worker nodes
  workers:
    hosts:
      dv04:

  # Storage nodes
  storage:
    hosts:
      dv05:
      dv06: